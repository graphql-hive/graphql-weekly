---
import Layout from '../layouts/Layout.astro'
import '../index.css'
import { IndexPage } from '../islands/index'
import { serverFetch } from '../client/fetcher'
import { AllIssuesDocument, type AllIssuesQuery } from '../generated/graphql'

let initialIssues: AllIssuesQuery['allIssues'] = []
try {
  const data = await serverFetch<AllIssuesQuery>(AllIssuesDocument)
  initialIssues = data.allIssues ?? []
} catch (e) {
  console.error('[index.astro] SSR fetch failed:', e)
}
---

<Layout title="GraphQL Weekly CMS">
  <IndexPage client:load initialIssues={initialIssues} />
</Layout>
